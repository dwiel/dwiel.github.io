<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title> Single Instance Application with command line interface  | Zach Dwiel</title>
  <meta name="author" content="Zach Dwiel">
  
  <meta name="description" content="I wanted a python gtk application to open a new window on its first execution and then have subsequent executions send their command line arguments to">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content=" Single Instance Application with command line interface "/>
  <meta property="og:site_name" content="Zach Dwiel"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Zach Dwiel" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Zach Dwiel</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-01-01T05:00:00.000Z"><a href="/blog/single-instance-application-with-command-line-interface/">2013-01-01</a></time>
      
      
  
    <h1 class="title"> Single Instance Application with command line interface </h1>
  

    </header>
    <div class="entry">
      
        <p>I wanted a python gtk application to open a new window on its first execution and then have subsequent executions send their command line arguments to the initial application rather than starting a new one.  Here is the template which provides that functionality:</p>
<p>download <a href="/files/singleinstanceapp.py">singleinstanceapp.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="string">"""</span><br><span class="line">This will only spawn one gtk application at a time.  If this command is executed </span><br><span class="line">while an instance is already running, the command line arguments are sent to the</span><br><span class="line">already running application.</span><br><span class="line">"""</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> pygtk</span><br><span class="line">pygtk.require(<span class="string">'2.0'</span>)</span><br><span class="line"><span class="keyword">import</span> gtk</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> SocketServer</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadedTCPRequestHandler</span><span class="params">(SocketServer.BaseRequestHandler)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></span><br><span class="line">		data = self.request.recv(<span class="number">1024</span>)</span><br><span class="line">		cur_thread = threading.currentThread()</span><br><span class="line"> </span><br><span class="line">		<span class="comment"># do something with the request:</span></span><br><span class="line">		self.server.app.label.set_label(data)</span><br><span class="line"> </span><br><span class="line">		<span class="comment"># could instead of the length of the input, could return error codes, more</span></span><br><span class="line">		<span class="comment"># information (if the request was a query), etc.  Using a length function</span></span><br><span class="line">		<span class="comment"># as a simple example</span></span><br><span class="line">		response = <span class="string">'string length: %d'</span> % len(data)</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">print</span> <span class="string">'responding to'</span>,data,<span class="string">'with'</span>,response</span><br><span class="line">		self.request.send(response)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadedTCPServer</span><span class="params">(SocketServer.ThreadingMixIn, SocketServer.TCPServer)</span>:</span></span><br><span class="line">	stopped = <span class="keyword">False</span></span><br><span class="line">	allow_reuse_address = <span class="keyword">True</span></span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">serve_forever</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">while</span> <span class="keyword">not</span> self.stopped:</span><br><span class="line">			self.handle_request()</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">force_stop</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.server_close()</span><br><span class="line">		self.stopped = <span class="keyword">True</span></span><br><span class="line">		self.create_dummy_request()</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">create_dummy_request</span><span class="params">(self)</span>:</span></span><br><span class="line">		client(self.server_address[<span class="number">0</span>], self.server_address[<span class="number">1</span>], <span class="string">'last message for you'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">client</span><span class="params">(ip, port, message)</span>:</span></span><br><span class="line">	sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">	sock.connect((ip, port))</span><br><span class="line">	sock.send(message)</span><br><span class="line">	response = sock.recv(<span class="number">1024</span>)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">"Received: %s"</span> % response</span><br><span class="line">	sock.close()</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_server</span><span class="params">(host, port)</span>:</span></span><br><span class="line"> </span><br><span class="line">	server = ThreadedTCPServer((host, port), ThreadedTCPRequestHandler)</span><br><span class="line">	ip, port = server.server_address</span><br><span class="line"> </span><br><span class="line">	<span class="comment"># Start a thread with the server -- that thread will then start one</span></span><br><span class="line">	<span class="comment"># more thread for each request</span></span><br><span class="line">	server_thread = threading.Thread(target=server.serve_forever)</span><br><span class="line">	<span class="comment"># Exit the server thread when the main thread terminates</span></span><br><span class="line">	server_thread.setDaemon(<span class="keyword">True</span>)</span><br><span class="line">	server_thread.start()</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">return</span> server</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleInstanceApp</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">destroy</span><span class="params">(self, widget, data=None)</span>:</span></span><br><span class="line">		self.server.force_stop()</span><br><span class="line">		gtk.main_quit()</span><br><span class="line">		<span class="comment">#exit(1) # I'm sorry but mozembed is making a huge pain in my ass</span></span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, server)</span>:</span></span><br><span class="line">		self.server = server</span><br><span class="line"> </span><br><span class="line">		<span class="comment"># create a new window</span></span><br><span class="line">		self.window = gtk.Window(gtk.WINDOW_TOPLEVEL)</span><br><span class="line">		self.window.set_default_size(<span class="number">300</span>,<span class="number">30</span>)</span><br><span class="line">		self.window.connect(<span class="string">"destroy"</span>, self.destroy)</span><br><span class="line"> </span><br><span class="line">		self.label = gtk.Label(<span class="string">"hello world"</span>)</span><br><span class="line">		self.window.add(self.label)</span><br><span class="line"> </span><br><span class="line">		self.window.show_all()</span><br><span class="line"> </span><br><span class="line">		<span class="comment"># and the window</span></span><br><span class="line">		self.window.show()</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">		gtk.gdk.threads_init()</span><br><span class="line">		gtk.main()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	<span class="comment"># pick some high port number here.  Should probably put this into a file </span></span><br><span class="line">	<span class="comment"># somewhere.</span></span><br><span class="line">	HOST, PORT = <span class="string">"localhost"</span>, <span class="number">50010</span></span><br><span class="line"> </span><br><span class="line">	server = <span class="keyword">None</span></span><br><span class="line">	<span class="keyword">try</span> :</span><br><span class="line">		client(HOST, PORT, <span class="string">' '</span>.join(sys.argv))</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'an insance was already open'</span></span><br><span class="line">	<span class="keyword">except</span> socket.error :</span><br><span class="line">		exceptionType, exceptionValue, exceptionTraceback = sys.exc_info()</span><br><span class="line">		<span class="keyword">if</span> exceptionValue[<span class="number">0</span>] == <span class="number">111</span> :</span><br><span class="line">			<span class="keyword">print</span> <span class="string">'this is the first instance'</span></span><br><span class="line">			server = start_server(HOST, PORT)</span><br><span class="line">		<span class="keyword">else</span> :</span><br><span class="line">			<span class="comment"># don't actually know what happened ...</span></span><br><span class="line">			<span class="keyword">raise</span></span><br><span class="line"> </span><br><span class="line">		app = SingleInstanceApp(server)</span><br><span class="line">		server.app = app</span><br><span class="line">		app.main()</span><br></pre></td></tr></table></figure>
<p>The first execution of this script starts an asynchronous server on a predetermined port.  This port is checked each time the script is run to see if another instance has already been started.  If it has, the command line arguments are sent to the existing instance which can react to them however you want.</p>
<p>download <a href="/files/singleinstanceapp.py">singleinstanceapp.py</a></p>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/Code/">Code</a>, <a href="/tags/Script/">Script</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://dwiel.github.io/blog/single-instance-application-with-command-line-interface/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:dwiel.github.io">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Axpress/">Axpress</a><small>2</small></li>
  
    <li><a href="/tags/Bug-Fix/">Bug Fix</a><small>4</small></li>
  
    <li><a href="/tags/CEB-Press/">CEB Press</a><small>6</small></li>
  
    <li><a href="/tags/Code/">Code</a><small>15</small></li>
  
    <li><a href="/tags/Data-Exploration/">Data Exploration</a><small>1</small></li>
  
    <li><a href="/tags/FYI/">FYI</a><small>9</small></li>
  
    <li><a href="/tags/Family/">Family</a><small>1</small></li>
  
    <li><a href="/tags/Food/">Food</a><small>2</small></li>
  
    <li><a href="/tags/Foundation/">Foundation</a><small>3</small></li>
  
    <li><a href="/tags/How-to/">How to</a><small>6</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>11</small></li>
  
    <li><a href="/tags/Music/">Music</a><small>2</small></li>
  
    <li><a href="/tags/Our-House/">Our House</a><small>13</small></li>
  
    <li><a href="/tags/Politics/">Politics</a><small>4</small></li>
  
    <li><a href="/tags/Reflection/">Reflection</a><small>2</small></li>
  
    <li><a href="/tags/Script/">Script</a><small>2</small></li>
  
    <li><a href="/tags/Uncategorized/">Uncategorized</a><small>7</small></li>
  
    <li><a href="/tags/Welcome/">Welcome</a><small>1</small></li>
  
    <li><a href="/tags/Windows/">Windows</a><small>3</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Zach Dwiel
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>